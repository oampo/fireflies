<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Fireflies</title>
        <!-- Production -->
        <!--
        <script src="../../src/mootools/mootools-core-1.3-full-nocompat-yc.js"></script>
        <script src="js/mootools-more/mootools-more-yc.js"></script>
        <script src="../../src/glmatrix/glMatrix-0.9.4.min.js"></script>
        <script src="../../src/webglet/WebGLet.min.js"></script>
        <script src="../../src/firebugx/firebugx.js"></script>
        -->

        <!-- Development -->
        <script src="../webglet/trunk/src/mootools/mootools-core-1.3-full-nocompat.js"></script>
        <script src="js/mootools-more/mootools-more.js"></script>
        <script src="../webglet/trunk/src/glmatrix/glMatrix-0.9.4.js"></script>
        <script src="../webglet/trunk/src/webgl-debug/webgl-debug.js"></script>
        <script src="../webglet/trunk/src/webglet/WebGLet.js"></script>

        <!-- Common -->
        <script src="../webglet/trunk/src/mixins/AudioOutput.js"></script>
        <script src="../webglet/trunk/src/mixins/MouseEvents.js"></script>
        <script src="js/Audio.js"></script>
        <script src="js/fireflies.js"></script>
        <link rel="stylesheet" href="css/960/reset.css" />
        <link rel="stylesheet" href="css/960/text.css" />
        <link rel="stylesheet" href="css/960/960.css" />
        <link rel="stylesheet" href="css/main.css" />

        <!-- Shaders -->
        <!-- Render point sprites to the framebuffer -->
        <script id="point-sprite-vert" type="x-shader/x-vertex">
            uniform mat4 uProjectionMatrix;
            uniform mat4 uModelviewMatrix;
            uniform vec3 uCameraPosition;

            attribute vec3 aVertex;
            attribute vec4 aColor;
            attribute vec2 aTexCoord;

            varying vec2 vTexCoord;
            varying vec4 vColor;

            void main(void) {
                vec3 viewDirection = normalize(uCameraPosition - aVertex);
                vec3 up = vec3(0.0, 1.0, 0.0);
                vec3 right = normalize(cross(viewDirection, up));
                vec3 vertex  = aVertex;
                vec3 actualUp = normalize(cross(right, viewDirection));
                vertex += right * (aTexCoord.x - 0.5) * 10.0;
                vertex += actualUp * (aTexCoord.y) * 10.0;

                gl_Position = uProjectionMatrix * uModelviewMatrix * vec4(vertex, 1.0);

                vTexCoord = aTexCoord;
                vColor = aColor;
            }
        </script>

        <script id="point-sprite-frag" type="x-shader/x-fragment">
            #ifdef GL_ES
            precision highp float;
            #endif
            
            uniform sampler2D uSampler;

            varying vec2 vTexCoord;
            varying vec4 vColor;

            void main(void) {
                gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;
            }
        </script>
            
        <!-- Blur and downsample a texture -->
        <script id="blur-frag" type="x-shader/x-fragment">
            #ifdef GL_ES
            precision highp float;
            #endif
            
            uniform sampler2D uSampler;
            uniform vec2 uOffset;

            varying vec2 vTexCoord;

            void main(void) {
                float dx = uOffset.x;
                float dy = uOffset.y;
                
                vec4 color = 4.0 * texture2D(uSampler, vTexCoord);
                
                color += 2.0 * texture2D(uSampler, vTexCoord + vec2(dx, 0.0));
                color += 2.0 * texture2D(uSampler, vTexCoord + vec2(-dx, 0.0));
                color += 2.0 * texture2D(uSampler, vTexCoord + vec2(0.0, +dy));
                color += 2.0 * texture2D(uSampler, vTexCoord + vec2(0.0, -dy));

                color += 1.0 * texture2D(uSampler, vTexCoord + vec2(+dx, +dy));
                color += 1.0 * texture2D(uSampler, vTexCoord + vec2(-dx, +dy));
                color += 1.0 * texture2D(uSampler, vTexCoord + vec2(-dx, -dy));
                color += 1.0 * texture2D(uSampler, vTexCoord + vec2(+dx, -dy));

                gl_FragColor = color / 16.0;
            }
        </script>
        
        <!-- Blend blurred textures -->
        <script id="blend-frag" type="x-shader/x-fragment">
            #ifdef GL_ES
            precision highp float;
            #endif
            
            uniform sampler2D uSampler0;
            uniform sampler2D uSampler1;
            uniform sampler2D uSampler2;

            varying vec2 vTexCoord;

            void main(void) {
                vec4 color0 = texture2D(uSampler0, vTexCoord);
                vec4 color1 = texture2D(uSampler1, vTexCoord);
                vec4 color2 = texture2D(uSampler2, vTexCoord);
                gl_FragColor = color0 + color1 + color2;
            }
        </script>

        <!-- Render the framebuffer to the screen -->
        <script id="texture-vert" type="x-shader/x-vertex">
            attribute vec3 aVertex;
            attribute vec2 aTexCoord;

            uniform mat4 uModelviewMatrix;
            uniform mat4 uProjectionMatrix;
            
            varying vec2 vTexCoord;

            void main(void) {
                gl_Position = uProjectionMatrix * uModelviewMatrix * vec4(aVertex, 1.0);
                vTexCoord = aTexCoord;
            }
        </script>

        <script id="texture-frag" type="x-shader/x-fragment">
            #ifdef GL_ES
            precision highp float;
            #endif
            
            uniform sampler2D uSampler;

            varying vec2 vTexCoord;

            void main(void) {
                gl_FragColor = texture2D(uSampler, vTexCoord);
            }
        </script>
    </head>
    <body>
        <div id="wrapper">
            <div class="container_12">
                <div class="grid_12" id="header">
                    <img src="images/banner.png" alt="Fireflies" />
                </div>
                <div class="grid_12" id="webgl">
                </div>
                <div class="grid_12" id="controls">
                    <div class="grid_4 alpha">
                        <div class="grid_4 alpha omega center">
                            <strong>
                                ATTRACT
                            </strong>
                        </div>
                        <div class="grid_3 alpha">
                            <div class="slider" id="attract-slider">
                                <div class="knob">
                                </div>
                            </div>
                        </div>
                        <div class="grid_1 omega center xy">
                            <a href="#" id="attract-x">X</a>
                            &nbsp;
                            <a href="#" id="attract-y">Y</a>
                        </div>
                    </div>
                    <div class="grid_4">
                        <div class="grid_4 alpha omega center">
                            <strong>
                                REPEL
                            </strong>
                        </div>
                        <div class="grid_3 alpha">
                            <div class="slider" id="repel-slider">
                                <div class="knob">
                                </div>
                             </div>
                        </div>
                        <div class="grid_1 omega center xy">
                            <a href="#" id="repel-x">X</a>
                            &nbsp;
                            <a href="#" id="repel-y">Y</a>
                        </div>
                    </div>
                    <div class="grid_4 omega">
                        <div class="grid_4 alpha omega center">
                            <strong>
                                MATCH
                            </strong>
                        </div>
                        <div class="grid_3 alpha">
                            <div class="slider" id="match-slider">   
                                <div class="knob">
                                </div>
                            </div>
                        </div>
                        <div class="grid_1 omega center xy">
                            <a href="#" id="match-x">X</a>
                            &nbsp;
                            <a href="#" id="match-y">Y</a>
                        </div>
                    </div>
                    <div class="grid_4 alpha" id="volume">
                        <div class="grid_4 alpha omega center">
                            <strong>
                                VOLUME
                            </strong>
                        </div>
                        <div class="grid_4 alpha omega center">
                            <div class="slider" id="volume-slider">
                                <div class="knob">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="grid_4">
                        <div class="grid_4 alpha omega center">
                            <strong>
                                FIREFLIES
                            </strong>
                        </div>
                        <div class="grid_4 alpha omega center">
                            <a href="#" id="reset">
                                REPOSITION
                            </a>
                        </div>
                    </div>
                    <div class="grid_4 omega" id="audio-buffer">
                        <div class="grid_4 alpha omega center">
                            <strong>
                                AUDIO BUFFER
                            </strong>
                        </div>
                        <div class="grid_4 alpha omega center">
                            <a href="#" id="smaller-buffer">
                                SMALLER
                            </a>
                            /
                            <a href="#" id="larger-buffer">
                                LARGER
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div id="push"></div>
        </div>
        <div id="footer">
            <div id="about" style="display: none">
                <div class="center"><strong>ABOUT FIREFLIES</strong></div>
                    Fireflies is an audio-visual game inspired by the behaviour of swarms of fireflies.  Players take the viewpoint of a single firefly within the swarm, having control over the forces governing the patterns and music generated by the swarm.   The game looks to explore the structural relationship between swarms and music, and the necessity of precise control in improvised audio-visuals.
            </div>

            <div id="tips" style="display: none">
                <div class="center"><strong>TIPS</strong></div>
                <ul>
                    <li>
                        No graphics?  Get a WebGL enabled browser.
                    </li>
                    <li>
                        For audio, use Firefox 4 Beta.
                    </li>
                    <li>
                        Audio crackly?  Increase the audio buffer size.
                    </li>
                    <li>
                        Audio laggy?  Decrease the audio buffer size.
                    </li>
                    <li>
                        Hit F11.  Fireflies looks better in fullscreen.
                    </li>
                </ul>
                <hr />
                <ul>
                    <li>
                        Change forces, but wait for results.
                    </li>
                    <li>
                        Do nothing.  The fireflies are happy to be left alone.
                    </li>
                    <li>
                        Lost the other fireflies?  Reposition them.
                    </li>
                    <li>
                        Balanced forces often sound better.
                    </li>
                    <li>
                        Move slowly.  Then move quickly.
                    </li>
                    <li>
                        Closer fireflies sound more alike.
                    </li>
                    <li>
                        Think about depth.  Fireflies move in three dimensions.
                    </li>
                    <li>
                        Have fun.
                    </li>
                </ul>
            </div>

            <div>
                FIREFLIES IS AN AUDIO-VISUAL GAME BY <a href="http://www.oampo.co.uk">O<span class="amp">&amp;</span>O</a> | <a href="#" id="about-link">ABOUT</a> | <a href="#" id="tips-link">TIPS</a>
            </div>
        </div>
    </body>
</html>
